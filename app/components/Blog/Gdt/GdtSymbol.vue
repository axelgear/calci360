<script setup lang="ts">
import { computed } from 'vue'

const props = defineProps<{
  symbol: string // e.g., 'straightness', 'flatness', 'position'
  label?: string
  size?: string // e.g., '24px', '32px'
  color?: string // e.g., '#334155'
}>()

const sizeValue = computed(() => props.size || '48px')
const colorValue = computed(() => props.color || 'currentColor')

/* SVG paths for GD&T symbols - extracted from FreeCAD-GDT */
const symbols: Record<string, { path: string; viewBox?: string }> = {
  /* Form tolerances */
  straightness: {
    path: 'M 7 30.242188 L 7 33.757812 L 57 33.757812 L 57 30.242188 L 7 30.242188 z',
    viewBox: '0 0 64 64'
  },
  flatness: {
    path: 'M 20.830078 22.136719 L 8.6230469 41.863281 L 43.169922 41.863281 L 55.376953 22.136719 L 20.830078 22.136719 z M 22.271484 23.578125 L 52.447266 23.578125 L 41.705078 40.421875 L 11.773438 40.421875 L 22.271484 23.578125 z',
    viewBox: '0 0 64 64'
  },
  circularity: {
    path: 'M 31.988281 21.246094 C 30.197917 21.246094 28.440104 21.708984 26.714844 22.636719 C 24.989583 23.564453 23.645833 24.891927 22.685547 26.617188 C 21.72526 28.326172 21.246094 30.116536 21.246094 31.988281 C 21.246094 34.966797 22.294922 37.505859 24.394531 39.605469 C 26.494141 41.705078 29.033203 42.753906 32.011719 42.753906 C 34.973958 42.753906 37.505859 41.705078 39.605469 39.605469 C 41.705078 37.505859 42.753906 34.966797 42.753906 31.988281 C 42.753906 30.132812 42.27474 28.342448 41.314453 26.617188 C 40.354167 24.891927 39.010417 23.564453 37.285156 22.636719 C 35.559896 21.708984 33.794922 21.246094 31.988281 21.246094 z M 32.011719 23.101562 C 33.509115 23.101562 34.966797 23.483073 36.382812 24.248047 C 37.798828 25.013021 38.905599 26.11263 39.703125 27.544922 C 40.500651 28.977214 40.898438 30.458333 40.898438 31.988281 C 40.898438 34.445964 40.028646 36.545573 38.287109 38.287109 C 36.561849 40.028646 34.469401 40.898438 32.011719 40.898438 C 29.554036 40.898438 27.454427 40.028646 25.712891 38.287109 C 23.971354 36.545573 23.101562 34.445964 23.101562 31.988281 C 23.101563 30.458333 23.499349 28.977214 24.296875 27.544922 C 25.094401 26.11263 26.201172 25.013021 27.617188 24.248047 C 29.033203 23.483073 30.498047 23.101562 32.011719 23.101562 z',
    viewBox: '0 0 64 64'
  },
  cylindricity: {
    path: 'M 28.886719 23.052734 L 18.902344 40.361328 L 19.902344 40.947266 L 24.785156 32.451172 C 24.964193 34.420573 25.754557 36.041016 27.154297 37.310547 C 28.554036 38.580078 30.165365 39.214844 31.988281 39.214844 C 33.0625 39.214844 34.127604 38.961589 35.185547 38.457031 L 34.087891 40.361328 L 35.087891 40.947266 L 45.097656 23.662109 L 44.097656 23.052734 L 39.189453 31.548828 C 39.026693 29.579427 38.238281 27.968099 36.822266 26.714844 C 35.422526 25.445312 33.811198 24.810547 31.988281 24.810547 C 30.914063 24.810547 29.847005 25.061849 28.789062 25.566406 L 29.888672 23.662109 L 28.886719 23.052734 z M 31.988281 26.005859 C 33.632161 26.005859 35.039062 26.600911 36.210938 27.789062 C 37.399089 28.960937 37.994141 30.367839 37.994141 32.011719 C 37.994141 33.655599 37.399089 35.064453 36.210938 36.236328 C 35.039062 37.408203 33.632161 37.994141 31.988281 37.994141 C 30.344401 37.994141 28.928385 37.408203 27.740234 36.236328 C 26.568359 35.064453 25.982422 33.655599 25.982422 32.011719 C 25.982422 30.367839 26.568359 28.960938 27.740234 27.789062 C 28.928385 26.600911 30.344401 26.005859 31.988281 26.005859 z',
    viewBox: '0 0 64 64'
  },
  
  /* Orientation tolerances */
  perpendicularity: {
    path: 'M 30.609375 17.986328 L 30.632812 43.449219 L 17.888672 43.449219 L 17.888672 46.013672 L 46.111328 46.013672 L 46.085938 43.449219 L 33.171875 43.449219 L 33.171875 18.011719 L 30.609375 17.986328 z',
    viewBox: '0 0 64 64'
  },
  angularity: {
    path: 'M 46.453125 17.546875 L 17.546875 46.453125 L 46.453125 46.453125 L 46.453125 44.035156 L 23.40625 44.035156 L 46.453125 20.941406 L 46.453125 17.546875 z',
    viewBox: '0 0 64 64'
  },
  parallelism: {
    path: 'M 32.345703 9.1113281 L 19.007812 54.888672 L 21.425781 54.888672 L 34.761719 9.1113281 L 32.345703 9.1113281 z M 42.574219 9.1113281 L 29.238281 54.888672 L 31.654297 54.888672 L 44.992188 9.1113281 L 42.574219 9.1113281 z',
    viewBox: '0 0 64 64'
  },
  
  /* Location tolerances */
  position: {
    path: 'M 31.4375 14.105469 L 31.4375 24.652344 C 29.647135 24.847656 28.126302 25.578125 26.873047 26.847656 C 25.619792 28.100911 24.903646 29.616536 24.724609 31.390625 L 19.574219 31.390625 L 19.574219 32.585938 L 24.773438 32.585938 C 24.919922 34.360026 25.619792 35.882812 26.873047 37.152344 C 28.126302 38.405599 29.647135 39.136068 31.4375 39.347656 L 31.4375 49.894531 L 32.634766 49.894531 L 32.634766 39.347656 C 34.441406 39.152344 35.971354 38.421875 37.224609 37.152344 C 38.477865 35.882812 39.177734 34.360026 39.324219 32.585938 L 44.425781 32.585938 L 44.425781 31.390625 L 39.324219 31.390625 C 39.161458 29.60026 38.452474 28.070312 37.199219 26.800781 C 35.945964 25.53125 34.42513 24.815104 32.634766 24.652344 L 32.634766 14.105469 L 31.4375 14.105469 z M 31.4375 25.945312 L 31.4375 31.390625 L 25.96875 31.390625 C 26.115234 29.958333 26.69401 28.735677 27.703125 27.726562 C 28.728516 26.701172 29.972656 26.108073 31.4375 25.945312 z M 32.634766 25.945312 C 34.067057 26.091797 35.28776 26.677734 36.296875 27.703125 C 37.322266 28.71224 37.915365 29.942057 38.078125 31.390625 L 32.634766 31.390625 L 32.634766 25.945312 z M 25.96875 32.585938 L 31.4375 32.585938 L 31.4375 38.054688 C 30.005208 37.908203 28.777344 37.322266 27.751953 36.296875 C 26.742839 35.271484 26.147786 34.034505 25.96875 32.585938 z M 32.634766 32.585938 L 38.078125 32.585938 C 37.931641 34.018229 37.345703 35.248047 36.320312 36.273438 C 35.311198 37.282552 34.083333 37.875651 32.634766 38.054688 L 32.634766 32.585938 z',
    viewBox: '0 0 64 64'
  },
  concentricity: {
    path: 'M 32 17.546875 C 27.996094 17.546875 24.585286 18.953776 21.769531 21.769531 C 18.953776 24.585286 17.546875 27.996094 17.546875 32 C 17.546875 36.003906 18.953776 39.414714 21.769531 42.230469 C 24.585286 45.046224 27.996094 46.453125 32 46.453125 C 36.003906 46.453125 39.414714 45.046224 42.230469 42.230469 C 45.046224 39.414714 46.453125 36.003906 46.453125 32 C 46.453125 27.996094 45.046224 24.585286 42.230469 21.769531 C 39.414714 18.953776 36.003906 17.546875 32 17.546875 z M 32 19.939453 C 35.336589 19.939453 38.175781 21.120443 40.519531 23.480469 C 42.879557 25.824219 44.060547 28.663411 44.060547 32 C 44.060547 35.320312 42.879557 38.159505 40.519531 40.519531 C 38.175781 42.863281 35.336589 44.035156 32 44.035156 C 28.679687 44.035156 25.840495 42.863281 23.480469 40.519531 C 21.136719 38.159505 19.964844 35.320312 19.964844 32 C 19.964844 28.663411 21.136719 25.824219 23.480469 23.480469 C 25.840495 21.120443 28.679688 19.939453 32 19.939453 z M 32 22.355469 C 29.330729 22.355469 27.052083 23.299479 25.164062 25.1875 C 23.292318 27.059245 22.355469 29.330729 22.355469 32 C 22.355469 34.669271 23.292318 36.947917 25.164062 38.835938 C 27.052083 40.707682 29.330729 41.644531 32 41.644531 C 34.669271 41.644531 36.940755 40.707682 38.8125 38.835938 C 40.700521 36.947917 41.644531 34.669271 41.644531 32 C 41.644531 29.330729 40.700521 27.059245 38.8125 25.1875 C 36.940755 23.299479 34.669271 22.355469 32 22.355469 z M 32 24.773438 C 34.001953 24.773438 35.701823 25.482422 37.101562 26.898438 C 38.517578 28.298177 39.226562 29.998047 39.226562 32 C 39.226562 33.985677 38.517578 35.685547 37.101562 37.101562 C 35.701823 38.517578 34.001953 39.226562 32 39.226562 C 29.998047 39.226562 28.289062 38.526693 26.873047 37.126953 C 25.473307 35.710938 24.773438 34.001953 24.773438 32 C 24.773438 29.998047 25.482422 28.298177 26.898438 26.898438 C 28.314453 25.482422 30.014323 24.773438 32 24.773438 z',
    viewBox: '0 0 64 64'
  },
  symmetry: {
    path: 'M 28.056641 25.798828 L 28.056641 28.191406 L 35.917969 28.191406 L 35.917969 25.798828 L 28.056641 25.798828 z M 20.171875 30.804688 L 20.171875 33.195312 L 43.828125 33.195312 L 43.828125 30.804688 L 20.171875 30.804688 z M 28.056641 35.785156 L 28.056641 38.201172 L 35.917969 38.201172 L 35.917969 35.785156 L 28.056641 35.785156 z',
    viewBox: '0 0 64 64'
  },
  
  /* Profile tolerances */
  profileOfALine: {
    path: 'm 30.027897,27.837371 5.32753,0 m -16.05074,1.428254 q 6.25,-3.320313 12.695313,-3.320313 7.03125,0 12.695312,3.320313 Q 49.382812,32 53.875,36.6875 l -2.148438,1.367187 Q 46.0625,32.976562 42.15625,31.023437 37.46875,28.679687 32,28.679687 q -5.859375,0 -10.9375,2.34375 -4.101563,1.953125 -8.984375,7.03125 L 10.125,36.6875 q 3.710938,-4.492188 9.179687,-7.421875 z',
    viewBox: '0 0 64 64'
  },
  profileOfASurface: {
    path: 'M 31.988281 23.466797 C 27.317057 23.466797 23.304036 25.143229 19.951172 28.496094 C 16.614583 31.832682 14.947266 35.845703 14.947266 40.533203 L 49.052734 40.533203 C 49.052734 35.845703 47.376302 31.832682 44.023438 28.496094 C 40.686849 25.143229 36.675781 23.466797 31.988281 23.466797 z M 31.988281 25.859375 C 35.455078 25.859375 38.563802 26.998698 41.314453 29.277344 C 44.065104 31.539714 45.774089 34.485677 46.441406 38.115234 L 17.535156 38.115234 C 18.202474 34.485677 19.911458 31.539714 22.662109 29.277344 C 25.41276 26.998698 28.521484 25.859375 31.988281 25.859375 z',
    viewBox: '0 0 64 64'
  },
  
  /* Runout tolerances */
  circularRunOut: {
    path: 'M 45.207031 18.804688 L 33.5625 21.904297 L 38.664062 23.613281 L 18.792969 43.486328 L 20.5 45.195312 L 40.375 25.322266 L 42.082031 30.425781 L 45.207031 18.804688 z',
    viewBox: '0 0 64 64'
  },
  totalRunOut: {
    path: 'M 30.558594 18.876953 L 27.410156 21.734375 L 28.703125 22.222656 L 20.355469 45.123047 L 34.148438 45.123047 L 42.351562 22.613281 L 43.644531 23.125 L 43.058594 18.876953 L 39.910156 21.734375 L 41.203125 22.222656 L 33.292969 43.925781 L 22.113281 43.925781 L 29.851562 22.613281 L 31.144531 23.125 L 30.558594 18.876953 z',
    viewBox: '0 0 64 64'
  },
}

const symbolData = computed(() => symbols[props.symbol] || null)
const symbolPath = computed(() => symbolData.value?.path || '')
const viewBox = computed(() => symbolData.value?.viewBox || '0 0 64 64')
</script>

<template>
  <div class="gdt-symbol-wrapper" :title="label || symbol">
    <svg
      :width="sizeValue"
      :height="sizeValue"
      :viewBox="viewBox"
      class="gdt-symbol-icon"
      :style="{ color: colorValue }"
    >
      <path
        v-if="symbolPath"
        :d="symbolPath"
        fill="currentColor"
      />
    </svg>
    <span v-if="!symbolPath" class="gdt-symbol-placeholder material-icons">help_outline</span>
    <span v-if="label" class="gdt-symbol-label">{{ label }}</span>
  </div>
</template>

<style scoped lang="scss">
.gdt-symbol-wrapper {
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  gap: 0.25rem;
  text-align: center;
  flex-shrink: 0;
}

.gdt-symbol-icon {
  display: block;
  fill: currentColor; // Allows color prop to change SVG fill
}

.gdt-symbol-placeholder {
  font-size: 24px;
  color: var(--neutral-500);
}

.gdt-symbol-label {
  font-size: 0.75rem;
  color: var(--text);
  opacity: 0.8;
}
</style>
